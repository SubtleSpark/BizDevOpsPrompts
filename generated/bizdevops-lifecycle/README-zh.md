# 基于时序图的AI-人工协作开发方法

一种以“图”为中心，AI主导分析与设计、人工把控质量与落地的轻量协作方法论。

- **核心理念**：用技术时序图让AI精准理解，实现从需求到代码的可视化落地；用业务流程图让人快速校验价值与边界。
- **协作分工**：AI做“重分析、快生成”，人工做“定方向、控质量、审查与合入”。
- **变更可控**：以图为基，先评估影响再动代码，全过程留痕可追溯。

## 核心：双层图表知识库

- **技术时序图层**（给开发与AI）
  - 描述 API 调用序列、服务交互、数据流转、异常处理
  - 用于代码生成、影响分析与测试设计
- **业务流程图层**（给业务与产品）
  - 描述业务规则、决策与用户旅程
  - 用于需求澄清、场景覆盖与验收校对
- **协同机制**
  - 流程图抽象业务意图，时序图落实技术实现
  - 任何变更同时更新两层图，保持需求与实现的一致性

## 协作开发流程图

```mermaid
%%{config: {"theme": "base", "themeVariables": {"edgeLabelBackground": "transparent"}}}%%
flowchart TD
    subgraph init[0.知识库构建]
        A[🤖 扫描项目API<br/>生成技术时序图<br/>提取业务流程图]
    end

    subgraph center[时序图+流程图知识库]
        ST[📊 技术时序图库<br/>🔄 业务流程图库<br/>🔗 接口依赖关系]
    end

    subgraph analysis[1.需求影响分析]
        B[👤 业务分析师<br/>解析需求业务价值]
        C[👤 RD<br/>定位受影响API<br/>确认变更范围并评估技术风险]
    end

    subgraph design[2.设计更新]
        E[🤖 更新时序图和流程图<br/>🟢新增 🟡修改 🔴删除]
        F[👤 RD<br/>确认设计可行性]
        G1[🤖 生成系分文档<br/>记录接口修改逻辑<br/>技术实现方案]
    end

    subgraph parallel[3.测试开发并行准备]
        subgraph test[3A.测试准备路径]
            G[🤖 基于业务流程图<br/>自动生成测试用例<br/>单元+集成+端到端]
        end

        subgraph dev[3B.开发准备路径]
            I[👤 RD<br/>识别代码变更点]
            J[🤖 生成技术实现方案<br/>代码结构+数据库变更]
        end
    end

    subgraph review[4.质量审查]
        K[👤 交叉验证<br/>测试用例vs实现方案<br/>确保覆盖一致性]
    end

    subgraph impl[5.实现与回写]
        L[👤 编码实现+测试验证<br/>人工质量把控]
        M[🤖 同步更新知识库<br/>保持文档代码一致]
    end

    A --> ST

    B -->|查询现有依赖| ST
    ST -->|提供业务上下文| C

    C -->|明确变更范围| E
    ST -->|基于现有设计| E
    E --> F
    F -->|设计方案确认| G1

    G1 -->|系分文档驱动| G
    G1 -->|系分文档驱动| I
    ST -->|业务流程驱动| G
    ST -->|技术时序驱动| I

    G --> K
    I --> J
    J --> K

    K --> L
    L --> M
    M -->|知识库同步| ST

    style ST fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    style A fill:#f3e5f5
    style B fill:#fff3e0
    style C fill:#fff3e0
    style E fill:#f3e5f5
    style F fill:#fff3e0
    style G1 fill:#f3e5f5
    style G fill:#f3e5f5
    style I fill:#e8f5e8
    style J fill:#f3e5f5
    style K fill:#fce4ec
    style L fill:#fce4ec
    style M fill:#f3e5f5
```

## 实施步骤（精简版）

- **阶段0｜知识库构建（AI）**：扫描项目 → 生成 API 分析、时序图与流程图 → 建立接口依赖关系
- **阶段1｜需求影响分析（AI+人）**：基于图识别受影响 API/数据流/服务依赖 → 生成影响与风险报告 → 人工确认
- **阶段2｜设计更新（AI）**：同步更新两层图，标注新增/修改/删除 → 生成简明系分文档与实现要点
- **阶段3｜并行准备（AI+人）**：
  - 测试：按流程图与时序图生成单元/集成/E2E 用例
  - 开发：明确变更点与DB变更，生成实现方案与接口契约
- **阶段4｜质量审查（人）**：用“测试用例 vs 实现方案 vs 图”三方交叉验证覆盖与一致性
- **阶段5｜实现与回写（人+AI）**：编码与测试 → AI回写文档与图，保持“图-文-码”一致

## 关键交付物

- 图：更新后的技术时序图、业务流程图、接口依赖关系
- 文：影响分析与风险评估、简明系分文档、实现方案要点
- 测：覆盖完整的测试用例（单元/集成/E2E）与执行报告
- 码：经审查的生产代码与必要的数据库变更脚本

## 快速开始

1. 让 AI 扫描代码库，生成/更新两层图与接口依赖
2. 提交需求，用图做影响分析并出风险清单
3. 同步更新两层图，生成简明系分与接口契约
4. 自动生成测试用例，标注与需求/验收的映射关系
5. 人工审查“三方一致性”（图/用例/方案）后再开工
6. 实施与回写：开发与测试完成后，AI回写文档与图，闭环沉淀
